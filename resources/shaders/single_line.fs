// Author: @patriciogv
// Title: 4 cells DF

//#ifdef GL_ES
//precision mediump float;
//#endif

// uniform vec2 iResolution;
// uniform vec2 iMouse;
// uniform float iTime;
// uniform vec2 iResolution;
// uniform vec2 u_mouse;
// uniform float iTime;

// https://iquilezles.org/articles/distfunctions2d/
float sdSegment( in vec2 p, in vec2 a, in vec2 b )
{
    vec2 pa = p-a, ba = b-a;
    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );
    return length( pa - ba*h );
}

void mainImage(out vec4 fragColor, in vec2 fragCoord) {
    vec2 st = fragCoord.xy/iResolution.xy;
    st = st * 2. - 1.;
    st.x *= iResolution.x/iResolution.y;

    vec3 color = vec3(0.2);
    float pct = 0.;

    float norm_y = 0.5 + 0.5*sin(iTime);
    //float norm_y = u_mouse.y/iResolution.y;

    vec2 point[198];
    point[0] = vec2(0.016843363642692566, 0.9700605552643538);
    point[1] = vec2(0.025481557473540306, 0.9532682187855244);
    point[2] = vec2(-0.05106308311223984, 0.9196819961071014);
    point[3] = vec2(-0.125944584608078, 0.8756948933005333);
    point[4] = vec2(-0.17504484951496124, 0.809867650270462);
    point[5] = vec2(-0.1028255745768547, 0.7982225120067596);
    point[6] = vec2(-0.012774163857102394, 0.8034641146659851);
    point[7] = vec2(-0.014131183736026287, 0.7802172601222992);
    point[8] = vec2(0.0012145558139309287, 0.7424154579639435);
    point[9] = vec2(0.08237716555595398, 0.7461152076721191);
    point[10] = vec2(0.13581235706806183, 0.6889666020870209);
    point[11] = vec2(0.11580132693052292, 0.6183753907680511);
    point[12] = vec2(0.03469390794634819, 0.632456362247467);
    point[13] = vec2(-0.05306820198893547, 0.6431293189525604);
    point[14] = vec2(-0.13646388053894043, 0.6474519371986389);
    point[15] = vec2(-0.2203352004289627, 0.6430873274803162);
    point[16] = vec2(-0.30663207173347473, 0.6338063180446625);
    point[17] = vec2(-0.37999391555786133, 0.6174644827842712);
    point[18] = vec2(-0.3442996144294739, 0.6940721273422241);
    point[19] = vec2(-0.30170413851737976, 0.7687587589025497);
    point[20] = vec2(-0.29523637890815735, 0.8528506308794022);
    point[21] = vec2(-0.35693907737731934, 0.8571066707372665);
    point[22] = vec2(-0.3703102171421051, 0.7739427387714386);
    point[23] = vec2(-0.4123365879058838, 0.7449739575386047);
    point[24] = vec2(-0.34702470898628235, 0.7321398258209229);
    point[25] = vec2(-0.40302687883377075, 0.6792058348655701);
    point[26] = vec2(-0.4108871817588806, 0.5941152572631836);
    point[27] = vec2(-0.4164021611213684, 0.5083009302616119);
    point[28] = vec2(-0.40877190232276917, 0.4142525792121887);
    point[29] = vec2(-0.38739240169525146, 0.46613019704818726);
    point[30] = vec2(-0.3573564291000366, 0.5167106091976166);
    point[31] = vec2(-0.2859242260456085, 0.4864746928215027);
    point[32] = vec2(-0.19732517004013062, 0.4952893853187561);
    point[33] = vec2(-0.11443334072828293, 0.5191745162010193);
    point[34] = vec2(-0.03426080569624901, 0.5462531447410583);
    point[35] = vec2(0.045987099409103394, 0.5742131471633911);
    point[36] = vec2(0.12512849271297455, 0.5951315760612488);
    point[37] = vec2(0.19153599441051483, 0.5447931885719299);
    point[38] = vec2(0.2256356030702591, 0.4740651249885559);
    point[39] = vec2(0.13968956470489502, 0.46218013763427734);
    point[40] = vec2(0.15743525326251984, 0.4375513195991516);
    point[41] = vec2(0.23787231743335724, 0.4164329767227173);
    point[42] = vec2(0.2103513777256012, 0.3353930711746216);
    point[43] = vec2(0.16179139912128448, 0.26578831672668457);
    point[44] = vec2(0.10160531103610992, 0.20181947946548462);
    point[45] = vec2(0.036861542612314224, 0.14880460500717163);
    point[46] = vec2(-0.03921135142445564, 0.10875451564788818);
    point[47] = vec2(-0.1209753155708313, 0.08434844017028809);
    point[48] = vec2(-0.20639024674892426, 0.07487452030181885);
    point[49] = vec2(-0.2873782217502594, 0.09240376949310303);
    point[50] = vec2(-0.309733122587204, 0.1700950264930725);
    point[51] = vec2(-0.32159894704818726, 0.24749422073364258);
    point[52] = vec2(-0.24201656877994537, 0.23924583196640015);
    point[53] = vec2(-0.1934455931186676, 0.2986326217651367);
    point[54] = vec2(-0.12577098608016968, 0.3057842254638672);
    point[55] = vec2(-0.18583950400352478, 0.3710973262786865);
    point[56] = vec2(-0.2531537115573883, 0.4218079447746277);
    point[57] = vec2(-0.32982271909713745, 0.4091752767562866);
    point[58] = vec2(-0.38750049471855164, 0.3788822889328003);
    point[59] = vec2(-0.3796178996562958, 0.3699765205383301);
    point[60] = vec2(-0.3245500922203064, 0.40391403436660767);
    point[61] = vec2(-0.24471987783908844, 0.4094299077987671);
    point[62] = vec2(-0.1779441237449646, 0.3535004258155823);
    point[63] = vec2(-0.1404220163822174, 0.30035942792892456);
    point[64] = vec2(-0.2225911170244217, 0.32599514722824097);
    point[65] = vec2(-0.3039461076259613, 0.3360465168952942);
    point[66] = vec2(-0.2731095552444458, 0.3132609724998474);
    point[67] = vec2(-0.20973998308181763, 0.2785186767578125);
    point[68] = vec2(-0.277919739484787, 0.23777920007705688);
    point[69] = vec2(-0.35013625025749207, 0.2815987467765808);
    point[70] = vec2(-0.3157336711883545, 0.21726757287979126);
    point[71] = vec2(-0.3170418441295624, 0.12845319509506226);
    point[72] = vec2(-0.2595032751560211, 0.07515043020248413);
    point[73] = vec2(-0.16419070959091187, 0.06988215446472168);
    point[74] = vec2(-0.09057290852069855, 0.08522933721542358);
    point[75] = vec2(-0.009807253256440163, 0.11472654342651367);
    point[76] = vec2(0.06228828430175781, 0.15845632553100586);
    point[77] = vec2(0.13023918867111206, 0.21959275007247925);
    point[78] = vec2(0.1824885755777359, 0.2814885377883911);
    point[79] = vec2(0.22832350432872772, 0.35265105962753296);
    point[80] = vec2(0.26292967796325684, 0.4096542000770569);
    point[81] = vec2(0.23581679165363312, 0.3301393985748291);
    point[82] = vec2(0.19767272472381592, 0.25306910276412964);
    point[83] = vec2(0.157089501619339, 0.17809635400772095);
    point[84] = vec2(0.12097138166427612, 0.10099577903747559);
    point[85] = vec2(0.09089358150959015, 0.021135985851287842);
    point[86] = vec2(0.10814006626605988, 0.051109492778778076);
    point[87] = vec2(0.14107006788253784, 0.1290721297264099);
    point[88] = vec2(0.1801779717206955, 0.20601677894592285);
    point[89] = vec2(0.2169889658689499, 0.2775418758392334);
    point[90] = vec2(0.25769925117492676, 0.35792791843414307);
    point[91] = vec2(0.24788276851177216, 0.4256659150123596);
    point[92] = vec2(0.27633222937583923, 0.4979216456413269);
    point[93] = vec2(0.31278377771377563, 0.5696754455566406);
    point[94] = vec2(0.3198729157447815, 0.6557812392711639);
    point[95] = vec2(0.3103402554988861, 0.7403579652309418);
    point[96] = vec2(0.2966778576374054, 0.824897363781929);
    point[97] = vec2(0.32160624861717224, 0.8988768607378006);
    point[98] = vec2(0.28017881512641907, 0.9664337635040283);
    point[99] = vec2(0.19747905433177948, 0.9824517667293549);
    point[100] = vec2(0.1262373924255371, 1.021136013790965);
    point[101] = vec2(0.14108934998512268, 1.0022220704704523);
    point[102] = vec2(0.09957506507635117, 0.9727391954511404);
    point[103] = vec2(0.010053563863039017, 0.9753119070082903);
    point[104] = vec2(0.03298033028841019, 1.0071592116728425);
    point[105] = vec2(0.21964414417743683, 0.9739103931933641);
    point[106] = vec2(0.29834040999412537, 0.9454304352402687);
    point[107] = vec2(0.30370593070983887, 0.8671987354755402);
    point[108] = vec2(0.2511788308620453, 0.8840982094407082);
    point[109] = vec2(0.196635901927948, 0.9510311223566532);
    point[110] = vec2(0.18230308592319489, 0.9566703401505947);
    point[111] = vec2(0.23765712976455688, 0.8883667960762978);
    point[112] = vec2(0.2629072666168213, 0.8271417617797852);
    point[113] = vec2(0.18528908491134644, 0.7873861938714981);
    point[114] = vec2(0.12592154741287231, 0.7760930508375168);
    point[115] = vec2(0.14400061964988708, 0.8206457197666168);
    point[116] = vec2(0.07259232550859451, 0.8522875159978867);
    point[117] = vec2(-0.010236131958663464, 0.8339519947767258);
    point[118] = vec2(0.065034881234169, 0.880504846572876);
    point[119] = vec2(0.13917356729507446, 0.8634720593690872);
    point[120] = vec2(0.21209532022476196, 0.8196796029806137);
    point[121] = vec2(0.21890181303024292, 0.8868397921323776);
    point[122] = vec2(0.14867106080055237, 0.9400988928973675);
    point[123] = vec2(0.12874193489551544, 0.9706056900322437);
    point[124] = vec2(0.1320154219865799, 0.9418095424771309);
    point[125] = vec2(0.20188333094120026, 0.8935164511203766);
    point[126] = vec2(0.2087186723947525, 0.8267453759908676);
    point[127] = vec2(0.138092502951622, 0.8734330087900162);
    point[128] = vec2(0.05832739174365997, 0.8848390206694603);
    point[129] = vec2(-0.015379495918750763, 0.840655654668808);
    point[130] = vec2(0.02615693211555481, 0.8387102335691452);
    point[131] = vec2(0.1111365333199501, 0.8437296599149704);
    point[132] = vec2(0.10775388777256012, 0.798959955573082);
    point[133] = vec2(0.024115001782774925, 0.8012278527021408);
    point[134] = vec2(-0.06089657545089722, 0.810507670044899);
    point[135] = vec2(-0.14554448425769806, 0.799753412604332);
    point[136] = vec2(-0.14114870131015778, 0.8534313440322876);
    point[137] = vec2(-0.07445933669805527, 0.8996192067861557);
    point[138] = vec2(0.009047976695001125, 0.939454011619091);
    point[139] = vec2(-0.3061870038509369, 0.8663851767778397);
    point[140] = vec2(-0.3041299879550934, 0.7822539806365967);
    point[141] = vec2(-0.36194634437561035, 0.7706855088472366);
    point[142] = vec2(-0.34802383184432983, 0.8557871580123901);
    point[143] = vec2(0.2978613078594208, 0.7894154042005539);
    point[144] = vec2(0.3090035617351532, 0.7042554616928101);
    point[145] = vec2(0.3115013539791107, 0.612741082906723);
    point[146] = vec2(0.2954394817352295, 0.53268763422966);
    point[147] = vec2(0.23714223504066467, 0.4873198866844177);
    point[148] = vec2(0.19053424894809723, 0.5570866763591766);
    point[149] = vec2(0.11856964975595474, 0.6066440045833588);
    point[150] = vec2(0.15006932616233826, 0.6732447743415833);
    point[151] = vec2(0.10941695421934128, 0.7499534785747528);
    point[152] = vec2(0.18765889108181, 0.7806668877601624);
    point[153] = vec2(0.26308006048202515, 0.8192391842603683);
    point[154] = vec2(0.05275554582476616, 0.7902842611074448);
    point[155] = vec2(0.09255340695381165, 0.7623358517885208);
    point[156] = vec2(0.031839899718761444, 0.76360023021698);
    point[157] = vec2(0.01890154927968979, 0.775242418050766);
    point[158] = vec2(0.0683063268661499, 0.7664569020271301);
    point[159] = vec2(0.03205322474241257, 0.7443764209747314);
    point[160] = vec2(-0.02138468250632286, 0.7695700228214264);
    point[161] = vec2(-0.3380950689315796, 0.7159028351306915);
    point[162] = vec2(-0.3812994658946991, 0.643161416053772);
    point[163] = vec2(-0.3681122362613678, 0.5634516477584839);
    point[164] = vec2(-0.36110129952430725, 0.5677420496940613);
    point[165] = vec2(-0.3052907884120941, 0.5532239973545074);
    point[166] = vec2(-0.2231101095676422, 0.5420588552951813);
    point[167] = vec2(-0.1728641539812088, 0.5256244540214539);
    point[168] = vec2(-0.20080098509788513, 0.5785680413246155);
    point[169] = vec2(-0.2862078845500946, 0.5772713124752045);
    point[170] = vec2(-0.36747047305107117, 0.5919019877910614);
    point[171] = vec2(-0.3057534396648407, 0.6270268857479095);
    point[172] = vec2(-0.22217071056365967, 0.6364283561706543);
    point[173] = vec2(-0.1343308389186859, 0.6399042904376984);
    point[174] = vec2(-0.047542888671159744, 0.6360955238342285);
    point[175] = vec2(0.03665076941251755, 0.6256483197212219);
    point[176] = vec2(0.08406078070402145, 0.5976137220859528);
    point[177] = vec2(0.003884746227413416, 0.5671902894973755);
    point[178] = vec2(-0.07754738628864288, 0.5389547646045685);
    point[179] = vec2(-0.15687811374664307, 0.5128363072872162);
    point[180] = vec2(-0.2428533285856247, 0.4943579435348511);
    point[181] = vec2(-0.32642439007759094, 0.4990156888961792);
    point[182] = vec2(-0.37084338068962097, 0.5435545146465302);
    point[183] = vec2(-0.3949427008628845, 0.46248316764831543);
    point[184] = vec2(-0.4088176190853119, 0.5094994604587555);
    point[185] = vec2(-0.40332305431365967, 0.5930321216583252);
    point[186] = vec2(-0.39558038115501404, 0.6787325441837311);
    point[187] = vec2(-0.33913660049438477, 0.7288801372051239);
    point[188] = vec2(-0.3505326211452484, 0.7514905631542206);
    point[189] = vec2(-0.17367134988307953, 0.5596984028816223);
    point[190] = vec2(-0.20947137475013733, 0.5257136225700378);
    point[191] = vec2(-0.27863484621047974, 0.554166167974472);
    point[192] = vec2(-0.27528396248817444, 0.5716520547866821);
    point[193] = vec2(0.23965701460838318, 0.4322282075881958);
    point[194] = vec2(0.16453441977500916, 0.4430208206176758);
    point[195] = vec2(0.18336738646030426, 0.4606424570083618);
    point[196] = vec2(-0.23181530833244324, 0.32199716567993164);
    point[197] = vec2(-0.2717001438140869, 0.3200724720954895);

    float desiredHeight = 0.5;
    float total_length = 16.796014466592723;
    total_length *= desiredHeight;

    float totalDist = 0.0;
    float maxDist = total_length*norm_y;

    for (int i = 0; i < 197; i++) {
        vec2 a = point[i];
        vec2 b = point[i+1];
        a *= desiredHeight;
        b *= desiredHeight;
        float nextDist = distance(a, b);
        if (totalDist + nextDist < maxDist) {
            totalDist += nextDist;
            float seg = sdSegment(st, a, b);
            pct += 1.-step(0.005, seg);
        } else {
            float targetDist = maxDist - totalDist;
            float ratio = targetDist / nextDist;
            vec2 delta = b - a;

            float seg = sdSegment(st, a, a + ratio*delta);
            pct += 1.-step(0.005, seg);
            break;
        }
    }

    // float m_dist = 1.;  // minimum distance
    // int m_idx = -1;

    // // Iterate through the points positions
    // for (int i = 0; i < 6; i++) {
    //     float dist = distance(st, point[i]);

    //     if (dist < m_dist) {
    //         m_idx = i;
    //     }
    //     // Keep the closer distance
    //     m_dist = min(m_dist, dist);
    // }
    // pct = step(0.02, m_dist);

    color = vec3(pct);
    fragColor = vec4(color,1.0);
}
